#include <tunables/global>

/usr/bin/qbittorrent {
  # Grundläggande abstraktioner som alltid finns på Debian
  include <abstractions/base>
  include <abstractions/desktop>
  include <abstractions/ssl_certs>

  # Tillåt qBittorrent att öppna TCP/UDP över IPv4 och IPv6
  network inet stream,
  network inet dgram,
  network inet6 stream,
  network inet6 dgram,

  # Kör binären
  /usr/bin/qbittorrent rix,

  # Bibliotek som programmet laddar (läs‐endast)
  /lib/** mr,
  /usr/lib/** mr,

  # TLS‐certifikat
  /etc/ssl/certs/** r,

  # Inställningar och cache (ändra om du kör annan sökväg)
  owner @{HOME}/.config/qBittorrent/** rwk,
  owner @{HOME}/.cache/qBittorrent/** rwk,

  # Läs .torrent‐filer i hemkatalogen
  owner @{HOME}/**.torrent r,

  # Läs rätt att traversera hemkatalogens mappar (ej dolda filer)
  owner @{HOME}/ r,
  owner @{HOME}/**/ r,
  deny @{HOME}/**/.* r,

  # Huvud‐nedladdningskatalog: justera efter din setup
  owner @{HOME}/Downloads/** rw,

  # Temporära torrent‐filer
  owner /tmp/*.torrent rw,
  owner /tmp/qBittorrent/* rwk,

  # Tillgång till /proc för intern status
  owner @{PROC}/@{pids}/cmdline r,
  owner @{PROC}/@{pids}/fd/ r,
  owner @{PROC}/@{pids}/mountinfo r,
  owner @{PROC}/@{pids}/mounts r,

  # Tillgång till tty (terminal)
  /dev/tty[0-9]* rw,

  # Blockera allt annat
  deny /** x,
}

